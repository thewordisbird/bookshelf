{% extends 'base.html' %}

{% block style %}
<style>
   

    .user-name {
        padding-bottom: 10px !important;
        border-bottom: 1px solid #D8D8D8;
    }

    .user-img {
        border-radius: 50%;
    }

    .profile-section-header {
        padding-bottom: 10px !important;
        border-bottom: 1px solid #D8D8D8;
    }

    .divider {
        margin-bottom: 10px !important;
        border-bottom: 1px solid #D8D8D8;
    }

    .cover-img {
        margin-top: .5rem;
    }

    .star-icon {
    position: relative;
    top: 5px;
    color: black;

}

.create-icon {
    position: relative;
    top: 5px;

}
.tiny-small {
        font-size: 1.5rem;
    }

.profile-name {
    font-size: 1.5rem;
}

.edit-profile {
    font-size: .75rem;
    color: gray;
}

</style>
{% endblock %}

{% block title %}{{title}}{% endblock %}

{% block content %}
<div class="container">
    <!-- Reviews will go below-->
    <div class="row">
        <div class="col m10 offset-m1 review-container">
            <div class="col m2">
                <img class="user-img" src="https://via.placeholder.com/150">
            </div>
            <div class="col m10 ">
                <div class="row">
                    <div class="col m12">
                        <div class="user-name">
                            <span class="profile-name">{{ user['display_name']}} </span><a class="edit-profile" href="#">(edit profile)</a>
                        </div>
                    </div>
                    <div class="col m12">
                        Joined {{ user['created'].strftime('%B %d, %Y')}} <!--last Active this month--> <!--Add later. Requires databse update on login for last logged in-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col m10 offset-m1">
            <div class="profile-section-header">
                {{ user.display_name.upper() }} IS CURRENTLY READING:
            </div>
        </div>
    </div>
    {% for book in books %}
        {%if 'date_rated' not in book %}
        <div class="row">
            <div class="col m10 offset-m1 review-book-info">
                <div class="col m2">
                    {% if 'cover_url' in book %}
                    <a href="{{ url_for('books.book_details', book_id=book.bid) }}"><img class="cover-img" src={{ book.cover_url }} ></a>
                    {% else %}
                    <img class="cover-img" src="https://via.placeholder.com/150">
                    {% endif %}
                </div>
                <div class="col m10">
                    <div class="row">
                        <div class="col m6">
                            <h5><a href="{{ url_for('books.book_details', book_id=book.bid) }}">{{ book.title }}</a></h5>by {{ ', '.join(book.authors) }}
                        </div>
                        <div class="col m6 right-align">
                            <ul class="star-rating">
                                <a href="#"><i value="1" class="material-icons star-icon tiny-small set-review" >star_border</i></a>
                                <a href="#"><i value="2" class="material-icons star-icon tiny-small set-review" >star_border</i></a>
                                <a href="#"><i value="3" class="material-icons star-icon tiny-small set-review" >star_border</i></a>
                                <a href="#"><i value="4" class="material-icons star-icon tiny-small set-review" >star_border</i></a>
                                <a href="#"><i value="5" class="material-icons star-icon tiny-small set-review" >star_border</i></a>
                            </ul>
                            <a href="#" class="waves-effect waves-light btn">Leave Review</a>
                        </div>
    
                    </div>              
                </div> 
                
            </div> 
        </div>
        {% endif %}
    {% endfor %}
    

    <div class="row">
        <div class="col m10 offset-m1">
            <div class="profile-section-header">
                {{ user.display_name.upper() }} HAS READ:
            </div>
        </div>
    </div>
    {% for book in books %}
        {% if 'date_rated' in book %}
        <div class="row">
            <div class="col m10 offset-m1 review-book-info">
                <div class="col m2">
                    {% if 'cover_url' in book %}
                    <a href="{{ url_for('books.book_details', book_id=book.bid) }}"><img class="cover-img" src={{ book.cover_url }} ></a>
                    {% else %}
                    <img class="cover-img" src="https://via.placeholder.com/150">
                    {% endif %}
                </div>
                <div class="col m10">
                    <div class="row">
                        <div class="col m12">
                            <h5><a href="{{ url_for('books.book_details', book_id=book.bid) }}">{{ book.title }}</a></h5>by {{ ', '.join(book.authors) }}
                        </div>
                        <div class="col m12">
                            Rated it<span class="star-rated">
                                {% for i in range(book.rating | int) %}
                                    <i class="material-icons star-icon tiny-small" >star</i>
                                {% endfor %}
                                {% for j in range(book.rating | int, 5) %}
                                    <i class="material-icons star-icon tiny-small" >star_border</i>
                                {% endfor %}
                            </span>
                            <!--Update to date created when fixed-->
                            on {{ book.date_rated.strftime('%b %d, %Y') }} <a href="#"><i class="material-icons create-icon">create</i></a>
                        </div>
                        <div class="col m12 review-title">
                            <h6>{{ book.review_title }}</h6>
                        </div>
                        <div class="col m12 review-content">
                            {{ book.review_content }}
                        </div>
    
                    </div>              
                </div> 
                
            </div> 
        </div>











        <!--
        <div class="row">
            <div class="col m10 offset-m1 review-book-info">
                <div class="col m12">
                    The World Is Flat by Author Name
                </div>
                <div class="col m2">
                    {% if 'cover_url' in book %}
                    <img class="cover-img" src={{ book.cover_url }} >
                    {% else %}
                    <img class="cover-img" src="https://via.placeholder.com/150">
                    {% endif %}
                </div>
                <div class="col m10">
                    <div class="row">
                        <div class="col m12">
                            Rated it <span class="star-rated">
                                <i class="material-icons star-icon tiny-small" >star</i>
                                <i class="material-icons star-icon tiny-small" >star</i>
                                <i class="material-icons star-icon tiny-small" >star</i>
                                <i class="material-icons star-icon tiny-small" >star_half</i>
                                <i class="material-icons star-icon tiny-small" >star_border</i>
                            </span>
                            on Nov 13, 2019 <i class="material-icons create-icon tiny-small">create</i>
                        </div>
                        <div class="col m12 review-title">
                            <h6>The Pages Turned Themselves</h6>
                        </div>
                        <div class="col m12 review-content">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus congue cursus dui ac mollis. 
                            Mauris ornare dui vitae porta accumsan. Aliquam rutrum justo id nunc aliquam, porttitor tempus odio varius. Nunc arcu sapien, 
                            rhoncus in ultrices facilisis, commodo a augue. Orci varius natoque penatibus et magnis dis parturient montes, nascetur.
                        </div>
    
                    </div>              
                </div> 
            <div class="col m12 divider"></div>  
        </div>-->
        {% endif %}
    {% endfor %}
    
</div>
{% endblock %}


{% block body_scripts %}
<script>
    const ratingField = document.getElementById("rating");
    const starElements = document.getElementsByClassName("set-review");
    const stars = new Array;

    const setStars = (rating) => {
      for (let i=0; i<rating; i++) {
          stars[i].innerHTML= "star";
      };
      for (let j=rating; j<5; j++ ){
          stars[j].innerHTML="star_border";
      };
    };

    const removeStars = (rating) => {
      for (let i=rating-1; i<5; i++) {
          stars[i].innerHTML= "star_border";
      };
    };

    for (let i=0; i<starElements.length; i++) {
        starElements[i].addEventListener('click', function(){
          let starValue = this.getAttribute("value");
          if (this.innerHTML == "star_border") {
              setStars(starValue);
              ratingField.value = starValue ;
          } else {
              removeStars(starValue);
              ratingField.value = starValue - 1;
          };    
        }, false);
        stars.push(starElements[i])
    }
</script>
{% endblock %}