{% extends 'base.html' %}

{% block style %}
<style>
   
  .star-rating li {
        display: inline;
    }

.rating-label {
    font-size: 1rem;
    color: #9e9e9e;
}

.star-icon {
    position: relative;
    top: 8px;
    
    

}

.set-review {
    cursor: pointer;
}

.review-book-info{
    padding-bottom: 10px !important;
        border-bottom: 1px solid #D8D8D8;
}
</style>
{% endblock %}

{% block title %}{{title}}{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col m10 offset-m1 review-book-info">
            <div class="col m1">
                <img class="cover-img-review" src="{{ book['volumeInfo']['imageLinks']['thumbnail'] }}" width="50" height="75">
            </div>
            <div class="col m11">
                <h6>{{ book['volumeInfo']['title'] }}</h6>
                <span class="author">{{ ', '.join(book['volumeInfo']['authors']) }}</span><br>                    
            </div> 
        </div> 
    </div>
    <div class="row">
        <div class="col m10 offset-m1">
<form method=post enctype="multipart/form-data">
    {{ form.hidden_tag() }}
     <span class="rating-label"> My Rating:</span> <span class="star-rated">
         {% if rating %}
            {% for i in range(rating) %}
                <i value="{{ i+1 }}"" class="material-icons star-icon small teal-text text-lighten-2 set-review" >star</i>
            {% endfor %}
            {% for j in range(rating, 5) %}
                <i value="{{ j+1 }}"" class="material-icons star-icon small teal-text text-lighten-2 set-review" >star_border</i>
            {% endfor %}
        {% else %}
            <i value="1" class="material-icons star-icon small teal-text text-lighten-2 set-review" >star_border</i>
            <i  value="2" class="material-icons star-icon small teal-text text-lighten-2 set-review" >star_border</i>
            <i  value="3" class="material-icons star-icon small teal-text text-lighten-2 set-review" >star_border</i>
            <i  value="4" class="material-icons star-icon small teal-text text-lighten-2 set-review" >star_border</i>
            <i  value="5" class="material-icons star-icon small teal-text text-lighten-2 set-review" >star_border</i>
         {% endif %}
    </span>
    {{ form.rating() }}
    <div class="row">
        <div class="col s12">
            <div class="input-field">
                {{ form.review_title() }}
                {{ form.review_title.label }}
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col s12">
            <div class="input-field">
                {{ form.review_content(class="materialize-textarea") }}
                {{ form.review_content.label }}
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col s6">
            <div class="input-field">
                {{ form.date_started(class="datepicker") }}
                {{ form.date_started.label }}
            </div>
        </div>
        <div class="col s6">
            <div class="input-field">
                {{ form.date_finished(class="datepicker") }}
                {{ form.date_finished.label }}
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col s12">
            <button class="btn waves-effect waves-light" type="submit" name="action">Submit
                <i class="material-icons right">send</i>
            </button>
        </div>
    </div>
</form>  

        </div>
    </div>
  
</div>


{% endblock %}

{% block body_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
      var elems = document.querySelectorAll('.datepicker');
      var instances = M.Datepicker.init(elems, {
          format: 'mm/dd/yyyy'});
    });
  </script>

  <script>
      const ratingField = document.getElementById("rating");
      const starElements = document.getElementsByClassName("set-review");
      const stars = new Array;

      const setStars = (rating) => {
        for (let i=0; i<rating; i++) {
            stars[i].innerHTML= "star";
        };
        for (let j=rating; j<5; j++ ){
            stars[j].innerHTML="star_border";
        };
      };

      const removeStars = (rating) => {
        for (let i=rating-1; i<5; i++) {
            stars[i].innerHTML= "star_border";
        };
      };

      for (let i=0; i<starElements.length; i++) {
          starElements[i].addEventListener('click', function(){
            let starValue = this.getAttribute("value");
            if (this.innerHTML == "star_border") {
                setStars(starValue);
                ratingField.value = starValue ;
            } else {
                removeStars(starValue);
                ratingField.value = starValue - 1;
            };
          }, false);
          stars.push(starElements[i])
      }
  </script>
{% endblock %}